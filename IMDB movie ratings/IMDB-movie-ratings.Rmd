---
title: "IMDB Movie Ratings"
author: "Andrew Lee"
output: html_document
---

<br />
<br />
<br />

IMDb is an online database of information related to films, television programs, and video games. It also provides average ratings voted by user. As of January 2020, IMDb has approximately 6.5 million titles and 10.4 million personalities in its database, as well as 83 million registered users. In this project, I would like to see the relationship between runtime, released year, and average ratings on movies, based on IMDB data.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)

library(data.table)
library(dplyr)
library(tidyverse)
library(ggplot2)
library(mgcv)
library(plotly)

# Load data:
title = read.delim2("title.basics.tsv")
ratings = read.delim("title.ratings.tsv")

title = subset(title, titleType == "movie" )
movie = merge(title, ratings, by = "tconst", all.x = TRUE)
movie = na.omit(movie)
```

<br />

### Clean data:
```{r}
movie$runtimeMinutes = as.numeric(as.character(movie$runtimeMinutes))
movie$startYear = as.numeric(as.character(movie$startYear))

movie = movie[which(movie$runtimeMinutes<=200),]
movie = na.omit(movie)
```

Since it is not realistic a movie has a running time over 200 minutes, I decided to omit such movies.

<br />

### Build a model to represent the data:
```{r}
movie.gam = gam(averageRating ~ s(runtimeMinutes, startYear), data = movie)
```

<br />
<br />

In statistics, a generalized additive model (GAM) is a generalized linear model in which the linear predictor depends linearly on unknown smooth functions of some predictor variables, and interest focuses on inference about these smooth functions. 

The model relates a response variable, Y, to some predictor variables, xi. An exponential family distribution is specified for Y (for example normal, binomial or Poisson distributions) along with a link function g (for example the identity or log functions) relating the expected value of Y to the predictor variables.

The link functions may be functions with a specified parametric form (for example a polynomial, or an un-penalized regression spline of a variable) or may be specified non-parametrically, or semi-parametrically, simply as 'smooth functions', to be estimated by non-parametric means. So a typical GAM might use a scatterplot smoothing function, such as a locally weighted mean, for g1(x1), and then use a factor model for g2(x2). This flexibility to allow non-parametric fits with relaxed assumptions on the actual relationship between response and predictor, provides the potential for better fits to data than purely parametric models, but arguably with some loss of interpretability. 

<br />

### Make a grid:

```{r}
movie.grid = expand.grid(startYear = 1900:2010, runtimeMinutes = 0:200)
movie.gam.pred = as.vector(predict(movie.gam, newdata = movie.grid))
movie.gam.pred.df = data.frame(movie.grid, averageRating = movie.gam.pred)
```

<br />

### Plot the weighted votes against runtime:

```{r}
ggplot(movie.gam.pred.df, aes(x = startYear, y = averageRating)) + 
  geom_point() + 
  scale_size_area() + 
  geom_smooth(method.args = list(degree = 1), color = 'orange', se = FALSE) + 
  facet_wrap(~cut_number(runtimeMinutes, n = 10),) + 
  xlab("Year of Movie was Released") + 
  ylab("Average Movie Ratings") + 
  ggtitle("Movie Ratings") + 
  labs(subtitle="Based Year Released Grouped by Length of Movie(minutes)")
```

<br />

We see that there is not an direct linear relationship between the ratings and run times or year of production. A generalized additive model does seems to adequately fit our data for prediction. This faceted plot grouped by length of movie in minutes shows some different rating trends throughout the years. Films that are less than 80 minutes have experienced a dip in ratings during the 1950’s. The ratings for shorter films started to go down in around 1900 and did not start to gain higher ratings until the mid 1950’s and some until the 1960’s. There is a fairly flat trend of films between 80 to 160 minutes have had pretty steady ratings with their peaks being during the 1950’s and 1960’s. Films that are 160 to 200 minutes have gotten higher ratings after 1950 and have experienced only a slight decline. 

<br />

### Draw a graph with  contours:

```{r}
ggplot(movie.gam.pred.df, aes(x = runtimeMinutes, y = startYear, fill = averageRating)) + 
  geom_raster() + 
  scale_fill_distiller(palette = "RdYlBu") + 
  coord_fixed() + 
  geom_contour(aes(z = averageRating))
```

<br />

When looking at this contour plot larger trends can be seen of a rise in ratings of short films after 2000 and lower ratings for short films, specifically films around 40-50 minutes between 1940 – 1975. Peaks appear for films around 120 minutes in the 1930’s and films over 150 minutes after the 1950’s.

<br />

### Do a 3D plot of the predicted values:

```{r}
plot_ly(movie.gam.pred.df, x = ~runtimeMinutes, y = ~startYear, z = ~averageRating, type = "scatter3d", marker = list(size = .5))
```

<br />
<br />

# Do longer movies tend to get higher IMDB ratings, after accounting for their year of release?

<br />

### Substantive Question Answer:

It depends on the year movie first released. In the 1950’s and 60’s the average ratings of the longer movies tend to be higher than the shorter movies. The trend of favoring longer movies at that time were mostly resulted from the appearance of the television. In order to compete with TV, movie directors decided to make their movies longer and more spectacular, which TV cannot follows. For example, Lawrence of Arabia in 1962 has running time 216 minutes, and The Ten Commandments in 1956 has running time 222 minutes. Both of the movies are awarded Academy awards.

However, in 1980’s, this trend changed. At that time, videotapes were firstly invented, and many movie directors wanted to sell their movies in ancillary markets through videotapes. The problem was that the videotapes cannot contain movies longer than 3 hours. So, the makers decided to reduce the running time. Because of this reason, while there were still long and spectacular movies were created, a lot of shorter movies were also created. So, the highest average ratings were divided to longer movies and shorter movies.

Project files:
<https://github.com/aleedk1123/IMDBratings>